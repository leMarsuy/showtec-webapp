<div class="flex gap-4 container">
  <div class="bg-white rounded-3xl p-4 h-fit w-[24rem] flex-none sticky top-16">
    <div class="flex mb-6">
      <button mat-stroked-button class="w-full" [routerLink]="'../'">
        <mat-icon>arrow_back</mat-icon>Back to SOA List
      </button>
    </div>
  </div>
  <div class="flex flex-col w-full gap-4">
    <div class="bg-white rounded-3xl p-4 text-gray-900 w-full">
      <section [formGroup]="soaForm">
        <div class="flex mb-6 py-2 border-b-2 border-sky-700">
          <p class="text-sky-700 font-bold">SOA Details</p>
        </div>
        <div class="flex">
          <div class="w-[15rem] flex-none p-4">Recipient Name</div>
          <mat-form-field class="w-full" appearance="outline">
            <input
              matInput
              placeholder="Type Customer Name..."
              [matAutocomplete]="customerAuto"
              formControlName="_customerId"
            />
            <mat-autocomplete
              autoActiveFirstOption
              #customerAuto="matAutocomplete"
              (optionSelected)="autofillCustomerDetails($event.option.value)"
              [displayWith]="displayCustomer"
            >
              @for (option of filteredCustomers | async; track option) {
              <mat-option [value]="option">{{ option.name }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
        </div>
        <div class="flex">
          <div class="w-[15rem] flex-none p-4">Contact No.</div>
          <mat-form-field class="w-full" appearance="outline">
            <input
              matInput
              formControlName="mobile"
              placeholder="09XXXXXXXXX"
            />
          </mat-form-field>
        </div>
        <div class="flex">
          <div class="w-[15rem] flex-none p-4">Address</div>
          <mat-form-field class="w-full" appearance="outline">
            <textarea
              matInput
              rows="3"
              placeholder="Address"
              formControlName="address"
            ></textarea>
          </mat-form-field>
        </div>
        <div class="flex">
          <div class="w-[15rem] flex-none p-4">SOA Date</div>
          <mat-form-field class="w-full" appearance="outline">
            <input
              matInput
              placeholder="MM/DD/YYYY"
              formControlName="soaDate"
              [matDatepicker]="soaDatePicker"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="soaDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #soaDatePicker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="flex">
          <div class="w-[15rem] flex-none p-4">Due Date</div>
          <mat-form-field class="w-full" appearance="outline">
            <input
              matInput
              placeholder="MM/DD/YYYY"
              formControlName="dueDate"
              [matDatepicker]="dueDatePicker"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="dueDatePicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #dueDatePicker></mat-datepicker>
          </mat-form-field>
        </div>
      </section>
    </div>
    <div class="bg-white rounded-3xl p-4 text-gray-600 w-full">
      <section>
        <div class="flex mb-1 py-2 border-b-2 border-sky-700">
          <p class="text-sky-700 font-bold">Listing of Items</p>
        </div>
        <div class="flex font-bold p-4 pb-2">
          <div class="w-full">Item</div>
          <div class="w-[7rem] flex-none">Qty</div>
          <div class="w-[10rem] flex-none">Unit Price</div>
          <div class="w-[7rem] flex-none">Disc</div>
          <div class="w-[10rem] flex-none">Amount</div>
          <div class="w-[7rem] flex-none text-center">Remove</div>
        </div>
        @if(listedItems.length){
        <div class="flex flex-col gap-4 p-4">
          @for (item of listedItems; track $index) {
          <div class="flex border-b-2 border-gray-100">
            <div class="w-full">
              <p>{{ item.brand }} {{ item.model }}</p>
            </div>
            <div class="w-[7rem] flex-none pr-2">
              <input [(ngModel)]="item.STATIC.quantity" class="w-full" />
            </div>
            <div class="w-[10rem] flex-none">
              {{ item.STATIC.unit_price }}
            </div>
            <div class="w-[7rem] flex-none pr-2">
              <input [(ngModel)]="item.STATIC.disc" class="w-full" />
            </div>
            <div class="w-[10rem] flex-none">{{ item.STATIC.total }}</div>
            <div
              class="w-[7rem] flex-none text-center text-rose-500"
              (click)="removeFromListedProducts($index)"
            >
              <mat-icon>close</mat-icon>
            </div>
          </div>
          }
        </div>
        }
        <div class="flex gap-4">
          <mat-form-field class="w-full" appearance="outline">
            <input
              [formControl]="productNameControl"
              matInput
              type="text"
              placeholder="Search Product Here..."
              [matAutocomplete]="productAuto"
            />
            <mat-autocomplete
              autoActiveFirstOption
              #productAuto="matAutocomplete"
              (optionSelected)="pushToListedProducts($event.option.value)"
            >
              @for (option of filteredProducts | async; track option) {
              <mat-option [value]="option">
                {{ option.brand }} {{ option.model }}
              </mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
          <button
            mat-flat-button
            class="mat-button-lg"
            (click)="searchSerialNumber()"
          >
            Search
          </button>
        </div>
      </section>
    </div>
    <div class="bg-white rounded-3xl p-4 text-gray-600 w-full">
      <section>
        <div class="flex mb-1 py-2 border-b-2 border-sky-700">
          <p class="text-sky-700 font-bold">Signatories</p>
        </div>
        <div class="flex font-bold p-4 pb-2">
          <div class="w-full">Name</div>
          <div class="w-full">Designation</div>
          <div class="w-full">Action</div>
          <div class="w-[10rem] flex-none text-center">Remove</div>
        </div>
        @if(listedSignatories.length){
        <div class="flex flex-col gap-4 p-4">
          @for (user of listedSignatories; track $index) {
          <div class="flex border-b-2 border-gray-100">
            <div class="w-full">
              <p>{{ user.name }}</p>
            </div>
            <div class="w-full">{{ user.designation }}</div>
            <div class="w-full">
              <mat-select [(ngModel)]="user.action">
                @for (action of signatoryActions; track action) {
                <mat-option [value]="action">{{ action }}</mat-option>
                }
              </mat-select>
            </div>
            <div class="w-[10rem] flex-none text-center">
              <mat-icon (click)="removeFromListedSignatories($index)">
                close
              </mat-icon>
            </div>
          </div>
          }
        </div>
        }
        <div class="flex gap-4">
          <mat-form-field class="w-full" appearance="outline">
            <input
              [formControl]="signatoryControl"
              matInput
              type="text"
              placeholder="Seach User here..."
              [matAutocomplete]="userAuto"
            />
            <mat-autocomplete
              autoActiveFirstOption
              #userAuto="matAutocomplete"
              (optionSelected)="pushToListedSignatories($event.option.value)"
            >
              @for (option of filteredUsers | async; track option) {
              <mat-option [value]="option">{{ option.name }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
        </div>
      </section>
    </div>

    <div class="bg-white rounded-3xl p-4 text-gray-600 w-full mb-[10rem]">
      <section>
        <div class="flex mb-1 py-2 justify-between gap-4">
          <button mat-stroked-button class="mat-button-lg" color="warn">
            Cancel Transaction
          </button>
          <button
            mat-flat-button
            class="mat-button-lg"
            color="primary"
            (click)="createSOA()"
          >
            Create SOA
          </button>
        </div>
      </section>
    </div>
  </div>
</div>
